<!DOCTYPE html>
<html lang="pl">
<head>
    <title>Mapy Analityczne</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/geotiff@2.0.7/dist-browser/geotiff.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-velocity-ts@1.1.0/dist/leaflet-velocity.js"></script>
    <style>
        html, body, #map { height: 100%; width: 100%; margin: 0; background: #2a2a2a; }
        .leaflet-control-layers-base label, .leaflet-control-layers-overlays label { color: #333; }
        .info-box { padding: 10px; background: rgba(255,255,255,0.9); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; }
        .legend .title { font-weight: bold; margin-bottom: 5px; text-align: center; font-size: 14px; }
        .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.9; border: 1px solid #ccc; }
        .legend .gradient { width: 100%; height: 18px; margin-top: 4px; border-radius: 3px; }
        .legend .labels { display: flex; justify-content: space-between; font-size: 12px; }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    const map = L.map('map').setView([54.16, 19.40], 13);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '© OpenStreetMap contributors, © CARTO'
    }).addTo(map);

    let velocityLayer = null;

    const overlayLayers = {
        "Pokrycie terenu": L.tileLayer('./wyniki/kafelki/landcover/{z}/{x}/{y}.png', { tms: true }),
        "Korony drzew": L.tileLayer('./wyniki/kafelki/korony_drzew/{z}/{x}/{y}.png', { tms: true }),
        "Model Terenu (NMT)": L.tileLayer('./wyniki/kafelki/nmt/{z}/{x}/{y}.png', { tms: true }),
        "Zasięg podtopień": L.tileLayer('./wyniki/kafelki/podtopienia/{z}/{x}/{y}.png', { tms: true }),
        "Prędkość wiatru": L.tileLayer('./wyniki/kafelki/wiatr/{z}/{x}/{y}.png', { tms: true }),
        "Komfort termiczny": L.tileLayer('./wyniki/kafelki/komfort/{z}/{x}/{y}.png', { tms: true })
    };
    L.control.layers(null, overlayLayers, { collapsed: false }).addTo(map);

    const legendControl = L.control({ position: "bottomright" });
    legendControl.onAdd = () => L.DomUtil.create("div", "legend-placeholder info-box");
    legendControl.addTo(map);

    function createGradientLegend(title, min, max, gradientCss) { /* ... */ }

    const legends = {
        "Pokrycie terenu": () => { /* ... */ },
        "Korony drzew": () => createGradientLegend("Wysokość drzew [m]", 4, 40, "linear-gradient(to right, #ffffcc, #006837)"),
        "Model Terenu (NMT)": () => createGradientLegend("Wysokość n.p.m.", 0, 100, "linear-gradient(to right, #398439, #e8e397, #bf8754)"),
        "Zasięg podtopień": () => createGradientLegend("Głębokość wody [m]", 0.01, 1.5, "linear-gradient(to right, #deebf7, #3182bd)"),
        "Prędkość wiatru": (weather) => { /* ... */ },
        "Komfort termiczny": (weather) => { /* ... */ }
    };
    
    let currentWeatherData = { temperature: 25, wind_speed: 5, wind_direction: 270 };
    // ... (reszta skryptu bez zmian)
</script>
</body>
</html>
